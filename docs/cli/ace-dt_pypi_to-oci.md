## ace-dt pypi to-oci

Fetch python packages from Python package indexes and upload to the OCI-REPOSITORY as OCI images

### Synopsis

This command is used to populate a OCI registry with python distributions.  The data will be pulled from the python package indexes specified and uploaded directly to the OCI registry without being written to disk.  This command will not transfer the same file twice and is idempotent.
		
Python distributions (source distributions and binary wheel distributions) to be synced can be specified in a number of ways.
1. Specify the project name at the end of the command line.  Version specifiers such as numpy>=3.9.2 are not currently supported.  Use selectors instead.
	$ ace-dt pypi to-oci reg.example.com/my/pypi numpy scipy===1.11.1

2. Specify the requirements file.  Currently we only support simple project names (no version specifier) or pinned versions with "--hash" of the distributions.  This file can be easily generated by "poetry export".
	$ ace-dt pypi to-oci reg.example.com/my/pypi -r requirements.txt

An example requirements file looks like this and is fully compatible with PIP (just not feature complete).

fsspec==2022.8.2 ; python_version >= "3.8" and python_version < "3.11" \
	--hash=sha256:6374804a2c0d24f225a67d009ee1eabb4046ad00c793c3f6df97e426c890a1d9 \
	--hash=sha256:7f12b90964a98a7e921d27fb36be536ea036b73bf3b724ac0b0bd7b8e39c7c18
aiohttp

Labels selectors can be used to further limit the files to be synced.  They work exactly like Kubernetes label selectors.  Each distribution file has the following labels:
- project - normalized project name (lower case with dash)
- version.major
- version.minor
- version.patch
- type (e.g., "sdist", "bdist_wheel")
- python
- abi
- platform

Limitations:
- Version specifiers of type === are supported but no others (e.g., ==, ~= are unsupported). Support can be added if needed.
- Only some of the directives in the requirements files are processed.


```
ace-dt pypi to-oci [-r file]... OCI-REPOSITORY [PROJECT]... [flags]
```

### Examples

```
This will pull numpy from pypi and upload it to reg.example.com/my/pypi
$ ace-dt pypi to-oci reg.example.com/my/pypi numpy -l 'version.major=1,version.minor>25,python=pp39'

or with a requirements file
$ ace-dt pypi to-oci reg.example.com/my/pypi -r requirements.txt
```

### Options

```
      --clean                         Construct entirely new OCI artifacts.  Do not reuse anything from OCI for caching purposes.
      --debug string                  Puts UI into debug mode, dumping all UI events to the given path.
      --dry-run                       Dry run by only determining what work needs to be done.  Does not modify the OCI registry.
      --extra-index-url stringArray   Extra URLs of package indexes to use in addition to --index-url. Should follow the same rules as --index-url.  This can also be set with the PIP_EXTRA_INDEX_URL environment variable.
  -h, --help                          help for to-oci
      --include-extras                Include the extra packages from requirements as requirements as well.  This is not needed if the extra packages are already included as individual requirements.
      --index-url string              Base URL of the Python Package Index. This should point to a repository compliant with PEP 503 (the simple repository API).  This can also be set with the PIP_INDEX_URL environment variable. (default "https://devpi.lion.act3-ace.ai/root/pypi/+simple/")
      --no-term                       Disable terminal support for fancy printing
  -q, --quiet                         Quiet mode.  Do not output any status to standard output.  Errors are still output to standard error.
      --reproducible                  Makes the uploaded artifacts have a consistent (reproducible) digest.  This removes timestamps.  As a result "ace-dt pypi serve" cannot provide efficient responses when If-Modified-Since requests are received.  The benefit is that this produces layers that are possibly better suited for mirroring.
  -r, --requirement stringArray       PIP compliant requirement file.  Used to define what python projects are synced.
  -l, --selector stringArray          Provide selectors for which python/abi/platform should be fetched.  The format follows Kubernetes selectors and the list of available label keys is in the help for this command.
```

### Options inherited from parent commands

```
      --allow-yanked               Do not ignore yanked distribution files
      --config stringArray         configuration file location (setable with env "ACE_DT_CONFIG").
                                   The first configuration file present is used.  Others are ignored.
                                    (default [ace-dt-config.yaml,HOMEDIR/.config/ace/dt/config.yaml,/etc/ace/dt/config.yaml])
  -v, --verbosity strings[=warn]   Logging verbosity level (also setable with environment variable ACE_DT_VERBOSITY)
                                   Aliases: error=0, warn=4, info=8, debug=12 (default [error])
```

### SEE ALSO

* [ace-dt pypi](ace-dt_pypi.md)	 - A command group for performing python package syncing operations

